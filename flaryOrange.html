<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiery Orange Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --fiery-orange: #FF4500;
            --charcoal-black: #1A1A1A;
            --soft-cream: #FFF5E6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--charcoal-black);
            color: var(--soft-cream);
            overflow-x: hidden;
            transition: background-color 0.5s ease;
        }
        
        /* Fiery Mode */
        body.fiery-mode {
            background-color: #0C0202;
            --fiery-orange: #FF6347;
            --soft-cream: #E8DCCA;
        }

        /* --- Global Animations --- */

        /* Embers */
        @keyframes embers {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-500px) scale(0.5); opacity: 0; }
        }

        .ember {
            position: absolute;
            background-color: var(--fiery-orange);
            border-radius: 50%;
            animation: embers linear infinite;
            pointer-events: none;
        }

        /* Hero Text Flame Trail */
        @keyframes flame-trail {
            0% { transform: translateY(50px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .flame-text span {
            display: inline-block;
            opacity: 0;
            transform: translateY(50px);
            animation: flame-trail 1s ease-out forwards;
        }

        /* Profile Ring Pulse */
        @keyframes ring-pulse {
            0%, 100% { box-shadow: 0 0 15px 5px var(--fiery-orange); }
            50% { box-shadow: 0 0 25px 10px var(--fiery-orange); }
        }
        .profile-ring {
            animation: ring-pulse 2s infinite alternate;
        }
        
        /* --- Section Transitions --- */

        .section-fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .section-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- About Section --- */

        @keyframes burning-letters {
            from {
                text-shadow: 0 0 5px var(--fiery-orange);
                transform: scale(1);
            }
            to {
                text-shadow: 0 0 10px var(--fiery-orange), 0 0 20px var(--fiery-orange);
                transform: scale(1.02);
            }
        }
        .burning-text {
            animation: burning-letters 1.5s infinite alternate;
        }

        /* --- Skills Section --- */

        @keyframes spark-ignite {
            from {
                transform: scaleX(0);
                background-color: transparent;
            }
            to {
                transform: scaleX(1);
                background-color: var(--fiery-orange);
            }
        }

        .skill-bar-inner {
            background-color: var(--fiery-orange);
            height: 100%;
            transform-origin: left;
            animation: spark-ignite 1s ease-out forwards;
        }

        /* --- Projects Section --- */

        .project-card:hover {
            box-shadow: 0 0 20px 5px var(--fiery-orange);
            transform: translateY(-5px);
        }

        /* --- Timeline Section --- */

        .timeline-line {
            position: relative;
            background-color: var(--charcoal-black);
            width: 4px;
            height: 100%;
        }

        .timeline-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(to top, var(--fiery-orange), transparent);
            animation: burn-fuse 3s ease-in forwards;
        }

        @keyframes burn-fuse {
            from { height: 0%; }
            to { height: 100%; }
        }

        /* --- Edit Button Styling --- */
        .edit-button {
            background-color: var(--fiery-orange);
            color: var(--charcoal-black);
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 9999px;
            border: 2px solid var(--soft-cream);
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.5), 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.3s ease, background-color 0.5s ease;
        }
        .edit-button:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px rgba(255, 69, 0, 0.7);
        }
        .edit-button i {
            margin-right: 0.5rem;
        }
        body.fiery-mode .edit-button {
            background-color: #FF6347;
            color: #000000;
            border-color: var(--soft-cream);
        }

        /* --- Publish/Unpublish Button Styling --- */
        .publish-button, .unpublish-button {
            background-color: var(--fiery-orange);
            color: var(--charcoal-black);
            padding: 0.75rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 9999px;
            border: 2px solid var(--soft-cream);
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.5), 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, box-shadow 0.3s ease, background-color 0.5s ease;
        }
        .publish-button:hover, .unpublish-button:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px rgba(255, 69, 0, 0.7);
        }
        .publish-button i, .unpublish-button i {
            margin-right: 0.5rem;
        }
        body.fiery-mode .publish-button, body.fiery-mode .unpublish-button {
            background-color: #FF6347;
            color: #000000;
            border-color: var(--soft-cream);
        }

        /* --- Modal Styling --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(26, 26, 26, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background: rgba(255, 69, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--fiery-orange);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .hidden {
            display: none;
        }

        /* --- Input Field Glow --- */
        .input-glow {
            box-shadow: 0 0 0 2px transparent;
            transition: box-shadow 0.3s ease-in-out;
        }
        .input-glow:focus {
            outline: none;
            box-shadow: 0 0 10px var(--fiery-orange), 0 0 20px var(--fiery-orange);
        }
    </style>
</head>
<body class="bg-charcoal-black text-soft-cream">

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBFoIoUsTJ_4NzkV-sdNffAOjbHRxSRIp8",
            authDomain: "echo-625fa.firebaseapp.com",
            projectId: "echo-625fa",
            storageBucket: "echo-625fa.firebasestorage.app",
            messagingSenderId: "890702112097",
            appId: "1:890702112097:web:e81927ba359a8c426c1120",
            measurementId: "G-DMBW4N7J2T"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        window.db = db;
        window.auth = auth;
        window.appId = 'default-app-id';
        window.firestore = { collection, addDoc, setDoc, doc, getDoc };

        signInAnonymously(auth).catch(error => {
            console.error('Authentication error:', error);
            document.getElementById('edit-form-status').textContent = 'Authentication failed. Please try again.';
            document.getElementById('edit-form-status').style.color = 'red';
        });
    </script>

    <!-- Fiery Mode Toggle -->
    <button id="fiery-toggle" class="fixed top-4 right-4 z-50 p-3 rounded-full bg-charcoal-black text-soft-cream transition-colors duration-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-3 2-3s2 .5 2 2-1 2-2 2h-1c-2 0-3 1-3 2-1 1 0 2 1 2z" />
        </svg>
    </button>

    <!-- Edit and Publish/Unpublish Buttons -->
    <div class="fixed top-6 left-6 z-50 space-y-4">
        <button id="edit-button" class="edit-button ring-pulse">
            <i class="fas fa-edit"></i> Edit Portfolio
        </button>
        <button id="publish-button" class="publish-button ring-pulse hidden">
            <i class="fas fa-globe"></i> Publish Portfolio
        </button>
        <button id="unpublish-button" class="unpublish-button ring-pulse hidden">
            <i class="fas fa-lock"></i> Unpublish Portfolio
        </button>
    </div>

    <!-- Edit Form Modal -->
    <div id="edit-form-container" class="modal hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-bold text-center mb-6 font-['Montserrat']">Edit Portfolio</h2>
            <form id="edit-form" class="space-y-6">
                <div>
                    <label for="edit-name" class="block text-sm font-medium mb-2">Your Name (Required)</label>
                    <input type="text" id="edit-name" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow" required>
                </div>
                <div>
                    <label for="edit-title" class="block text-sm font-medium mb-2">Your Title (e.g., Creative Developer)</label>
                    <input type="text" id="edit-title" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-about" class="block text-sm font-medium mb-2">About Yourself</label>
                    <textarea id="edit-about" rows="4" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow"></textarea>
                </div>
                <div>
                    <label for="edit-profile-image" class="block text-sm font-medium mb-2">Profile Image</label>
                    <input type="file" id="edit-profile-image" accept="image/*" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <!-- Project 1 -->
                <div>
                    <label for="edit-project1-title" class="block text-sm font-medium mb-2">Project 1 Title</label>
                    <input type="text" id="edit-project1-title" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project1-desc" class="block text-sm font-medium mb-2">Project 1 Description</label>
                    <input type="text" id="edit-project1-desc" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project1-image" class="block text-sm font-medium mb-2">Project 1 Image</label>
                    <input type="file" id="edit-project1-image" accept="image/*" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <!-- Project 2 -->
                <div>
                    <label for="edit-project2-title" class="block text-sm font-medium mb-2">Project 2 Title</label>
                    <input type="text" id="edit-project2-title" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project2-desc" class="block text-sm font-medium mb-2">Project 2 Description</label>
                    <input type="text" id="edit-project2-desc" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project2-image" class="block text-sm font-medium mb-2">Project 2 Image</label>
                    <input type="file" id="edit-project2-image" accept="image/*" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <!-- Project 3 -->
                <div>
                    <label for="edit-project3-title" class="block text-sm font-medium mb-2">Project 3 Title</label>
                    <input type="text" id="edit-project3-title" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project3-desc" class="block text-sm font-medium mb-2">Project 3 Description</label>
                    <input type="text" id="edit-project3-desc" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-project3-image" class="block text-sm font-medium mb-2">Project 3 Image</label>
                    <input type="file" id="edit-project3-image" accept="image/*" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <!-- Skills -->
                <div>
                    <label for="edit-skill1" class="block text-sm font-medium mb-2">Skill 1 (Name, Percentage, e.g., JavaScript,90)</label>
                    <input type="text" id="edit-skill1" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-skill2" class="block text-sm font-medium mb-2">Skill 2 (Name, Percentage)</label>
                    <input type="text" id="edit-skill2" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div>
                    <label for="edit-skill3" class="block text-sm font-medium mb-2">Skill 3 (Name, Percentage)</label>
                    <input type="text" id="edit-skill3" class="w-full p-3 rounded-md bg-transparent border border-fiery-orange text-soft-cream input-glow">
                </div>
                <div class="flex justify-between">
                    <button type="submit" class="p-4 rounded-lg bg-fiery-orange text-charcoal-black font-semibold">Save Changes</button>
                    <button type="button" id="cancel-edit" class="p-4 rounded-lg bg-charcoal-black text-soft-cream font-semibold border border-fiery-orange">Cancel</button>
                </div>
                <p id="edit-form-status" class="text-center text-sm font-bold text-soft-cream"></p>
            </form>
        </div>
    </div>

    <!-- Publish Confirmation Modal -->
    <div id="publish-modal" class="modal hidden">
        <div class="modal-content text-center">
            <p class="text-xl font-bold mb-4">Portfolio Published!</p>
            <p>Your portfolio is now live. Share it with the world!</p>
            <p id="publish-url" class="mt-4 text-fiery-orange break-all"></p>
            <button id="copy-url" class="mt-6 p-3 rounded-lg bg-fiery-orange text-charcoal-black font-semibold"><i class="fas fa-copy"></i> Copy URL</button>
            <button id="close-publish-modal" class="mt-2 p-3 rounded-lg bg-charcoal-black text-soft-cream font-semibold border border-fiery-orange">Close</button>
        </div>
    </div>

    <div id="ember-container" class="fixed inset-0 z-0 pointer-events-none"></div>

    <main class="relative z-10 px-4 md:px-8">

        <!-- Hero Section -->
        <section id="hero" class="min-h-screen flex flex-col items-center justify-center text-center">
            <div class="relative mb-8">
                <img id="profile-image" src="https://placehold.co/150x150/FF4500/FFF5E6?text=You" alt="Profile" class="w-40 h-40 rounded-full border-4 border-fiery-orange profile-ring">
            </div>
            <h1 id="hero-title" class="text-5xl md:text-7xl font-bold mb-4 flame-text">
                Your Name
            </h1>
            <p id="hero-subtitle" class="text-xl md:text-3xl text-soft-cream opacity-0 section-fade-in">
                A Creative Developer
            </p>
            <button class="mt-8 px-8 py-3 bg-fiery-orange text-charcoal-black font-bold rounded-full relative overflow-hidden transition-all duration-300 hover:scale-105">
                <span class="z-10 relative">🔥 Explore My Work</span>
            </button>
        </section>

        <!-- About Section -->
        <section id="about" class="py-20 section-fade-in">
            <div class="container mx-auto">
                <h2 class="text-4xl text-center mb-12">About Me</h2>
                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div class="text-center md:text-left">
                        <p id="about-title" class="text-xl md:text-2xl font-bold burning-text">Creating the Future.</p>
                        <p id="about-text" class="mt-4 text-lg">
                            I am a passionate developer with a fiery drive for building dynamic and immersive web experiences. My journey began with a simple curiosity, which has since ignited into a full-fledged obsession with clean code and innovative design. I believe every line of code should tell a story, and I am here to write them.
                        </p>
                    </div>
                    <div>
                        <div class="h-64 bg-charcoal-black rounded-xl border border-fiery-orange flex items-center justify-center text-soft-cream opacity-50">
                            Animated 3D Text Card Placeholder
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skills Section -->
        <section id="skills" class="py-20 section-fade-in">
            <div class="container mx-auto">
                <h2 class="text-4xl text-center mb-12">Skills</h2>
                <div id="skills-container" class="max-w-xl mx-auto space-y-6">
                    <!-- Skills will be dynamically injected here -->
                </div>
            </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="py-20 section-fade-in">
            <div class="container mx-auto">
                <h2 class="text-4xl text-center mb-12">Projects</h2>
                <div id="projects-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Projects will be dynamically injected here -->
                </div>
            </div>
        </section>
        
        <!-- Experience & Achievements Section -->
        <section id="experience" class="py-20 section-fade-in">
            <div class="container mx-auto">
                <h2 class="text-4xl text-center mb-12">Experience</h2>
                <div class="flex flex-col items-center">
                    <div class="relative w-full max-w-2xl">
                        <div class="absolute left-1/2 -translate-x-1/2 timeline-line h-full"></div>
                        <div class="space-y-12">
                            <div class="relative bg-charcoal-black p-6 rounded-lg border border-fiery-orange">
                                <span class="absolute -left-2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-fiery-orange border border-soft-cream"></span>
                                <h3 class="text-xl font-bold">Milestone 1</h3>
                                <p class="text-sm text-soft-cream/80">Started coding journey.</p>
                            </div>
                            <div class="relative bg-charcoal-black p-6 rounded-lg border border-fiery-orange">
                                <span class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-fiery-orange border border-soft-cream"></span>
                                <h3 class="text-xl font-bold">Milestone 2</h3>
                                <p class="text-sm text-soft-cream/80">Completed major project.</p>
                            </div>
                            <div class="relative bg-charcoal-black p-6 rounded-lg border border-fiery-orange">
                                <span class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-fiery-orange border border-soft-cream"></span>
                                <h3 class="text-xl font-bold">Milestone 3</h3>
                                <p class="text-sm text-soft-cream/80">Joined first team.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20 section-fade-in">
            <div class="container mx-auto">
                <h2 class="text-4xl text-center mb-12">Contact</h2>
                <div class="max-w-2xl mx-auto p-8 rounded-xl border border-fiery-orange relative">
                    <div class="absolute inset-0 rounded-xl" style="background: radial-gradient(circle at center, rgba(255, 69, 0, 0.3) 0%, transparent 60%);"></div>
                    <form id="contact-form" class="space-y-6 relative z-10">
                        <div>
                            <label for="name" class="block mb-2">Name</label>
                            <input type="text" id="name" class="w-full bg-transparent border-b-2 border-fiery-orange py-2 px-1 focus:outline-none focus:border-soft-cream transition-colors duration-300 input-glow">
                        </div>
                        <div>
                            <label for="email" class="block mb-2">Email</label>
                            <input type="email" id="email" class="w-full bg-transparent border-b-2 border-fiery-orange py-2 px-1 focus:outline-none focus:border-soft-cream transition-colors duration-300 input-glow">
                        </div>
                        <div>
                            <label for="message" class="block mb-2">Message</label>
                            <textarea id="message" rows="4" class="w-full bg-transparent border-b-2 border-fiery-orange py-2 px-1 focus:outline-none focus:border-soft-cream transition-colors duration-300 input-glow"></textarea>
                        </div>
                        <button type="submit" class="w-full py-3 rounded-full bg-fiery-orange text-charcoal-black font-bold relative overflow-hidden transition-all duration-300 hover:scale-105">
                            <span class="z-10 relative">Send 🔥</span>
                        </button>
                        <p id="form-status" class="text-center text-sm font-bold text-soft-cream"></p>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-8 text-center">
            <div class="container mx-auto">
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-3xl hover:text-fiery-orange transition-colors duration-300"><i class="fab fa-github"></i></a>
                    <a href="#" class="text-3xl hover:text-fiery-orange transition-colors duration-300"><i class="fab fa-linkedin"></i></a>
                </div>
                <p class="mt-4 text-sm">&copy; 2025 Your Name. All Rights Reserved.</p>
            </div>
        </footer>

    </main>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content text-center">
            <p class="text-xl font-bold mb-4">Message Sent!</p>
            <p>Your message has ignited a spark! I'll get back to you soon.</p>
            <button id="close-modal" class="mt-6 p-3 rounded-lg bg-fiery-orange text-charcoal-black font-semibold">Close</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Default data
            const defaultData = {
                name: 'Your Name',
                title: 'A Creative Developer',
                about: 'I am a passionate developer with a fiery drive for building dynamic and immersive web experiences. My journey began with a simple curiosity, which has since ignited into a full-fledged obsession with clean code and innovative design. I believe every line of code should tell a story, and I am here to write them.',
                profileImage: 'https://placehold.co/150x150/FF4500/FFF5E6?text=You',
                projects: [
                    { title: 'Project 1', description: 'A dynamic web app with real-time data.', image: 'https://placehold.co/400x300/FF4500/FFF5E6?text=Project+1' },
                    { title: 'Project 2', description: 'A stylish e-commerce platform.', image: 'https://placehold.co/400x300/FF4500/FFF5E6?text=Project+2' },
                    { title: 'Project 3', description: 'A creative portfolio design.', image: 'https://placehold.co/400x300/FF4500/FFF5E6?text=Project+3' }
                ],
                skills: [
                    { name: 'JavaScript', progress: 90 },
                    { name: 'React', progress: 85 },
                    { name: 'Tailwind CSS', progress: 95 }
                ],
                published: false,
                publicUrl: ''
            };

            let currentUserName = 'Your Name';

            // Hero Text Animation
            const heroTitleEl = document.getElementById('hero-title');
            const updateHeroTitle = () => {
                const text = currentUserName || defaultData.name;
                heroTitleEl.innerHTML = '';
                text.split('').forEach((char, index) => {
                    const span = document.createElement('span');
                    span.textContent = char;
                    span.style.animationDelay = `${index * 0.05}s`;
                    heroTitleEl.appendChild(span);
                });
            };

            // Embers Animation
            function createEmber() {
                const ember = document.createElement('div');
                ember.className = 'ember';
                const size = Math.random() * 5 + 2;
                ember.style.width = `${size}px`;
                ember.style.height = `${size}px`;
                ember.style.left = `${Math.random() * 100}vw`;
                ember.style.animationDuration = `${Math.random() * 5 + 3}s`;
                ember.style.animationDelay = `${Math.random() * 2}s`;
                document.getElementById('ember-container').appendChild(ember);

                ember.addEventListener('animationend', () => {
                    ember.remove();
                });
            }

            setInterval(createEmber, 200);

            // Intersection Observer for sections
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.section-fade-in').forEach(section => {
                observer.observe(section);
            });

            // Fiery Mode Toggle
            document.getElementById('fiery-toggle').addEventListener('click', () => {
                document.body.classList.toggle('fiery-mode');
            });

            // Edit Button and Form Logic
            const editButton = document.getElementById('edit-button');
            const editFormContainer = document.getElementById('edit-form-container');
            const editForm = document.getElementById('edit-form');
            const cancelEdit = document.getElementById('cancel-edit');
            const editFormStatus = document.getElementById('edit-form-status');

            editButton.addEventListener('click', async () => {
                await loadPortfolioData();
                editFormContainer.classList.remove('hidden');
            });

            cancelEdit.addEventListener('click', () => {
                editFormContainer.classList.add('hidden');
                editForm.reset();
                editFormStatus.textContent = '';
            });

            // Publish/Unpublish Button Logic
            const publishButton = document.getElementById('publish-button');
            const unpublishButton = document.getElementById('unpublish-button');
            const publishModal = document.getElementById('publish-modal');
            const publishUrl = document.getElementById('publish-url');
            const copyUrlButton = document.getElementById('copy-url');
            const closePublishModal = document.getElementById('close-publish-modal');

            // ImgBB API Key
            const IMGBB_API_KEY = '01400454f4aafb70d1c9beddec5cbbc5';

            // Upload image to ImgBB
            const uploadToImgBB = async (file) => {
                if (!file) return null;
                const formData = new FormData();
                formData.append('image', file);
                try {
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                        method: 'POST',
                        body: formData
                    });
                    const data = await response.json();
                    if (data.success) return data.data.url;
                    throw new Error('Image upload failed: ' + (data.error?.message || 'Unknown error'));
                } catch (error) {
                    throw new Error('Image upload failed: ' + error.message);
                }
            };

            // Clean object to remove undefined/null/empty values
            const cleanObject = (obj) => {
                if (Array.isArray(obj)) {
                    return obj
                        .map(item => cleanObject(item))
                        .filter(item => item !== null && item !== undefined && (typeof item !== 'object' || Object.keys(item).length > 0));
                }
                if (typeof obj !== 'object' || obj === null) return obj;
                const cleaned = {};
                Object.keys(obj).forEach(key => {
                    const value = obj[key];
                    if (value !== undefined && value !== null) {
                        if (Array.isArray(value)) {
                            const cleanedArray = cleanObject(value);
                            if (cleanedArray.length > 0) cleaned[key] = cleanedArray;
                        } else if (typeof value === 'object') {
                            const cleanedNested = cleanObject(value);
                            if (Object.keys(cleanedNested).length > 0) cleaned[key] = cleanedNested;
                        } else if (value !== '') cleaned[key] = value;
                    }
                });
                return Object.keys(cleaned).length > 0 ? cleaned : null;
            };

            // Save portfolio data to Firestore
            const savePortfolioData = async (data) => {
                try {
                    if (!data.name) {
                        editFormStatus.textContent = 'Please enter your name to save.';
                        editFormStatus.style.color = 'red';
                        return;
                    }
                    const docRef = window.firestore.doc(window.db, 'portfolio', data.name);
                    const cleanedData = cleanObject(data);
                    if (!cleanedData || Object.keys(cleanedData).length === 0) {
                        editFormStatus.textContent = 'No valid data to save.';
                        editFormStatus.style.color = 'red';
                        return;
                    }
                    await window.firestore.setDoc(docRef, cleanedData, { merge: true });
                    currentUserName = data.name;
                    editFormStatus.textContent = 'Portfolio updated successfully!';
                    editFormStatus.style.color = 'green';
                    await loadPortfolioData();
                    editFormContainer.classList.add('hidden');
                } catch (error) {
                    console.error('Error saving data:', error);
                    editFormStatus.textContent = 'Error updating portfolio: ' + error.message;
                    editFormStatus.style.color = 'red';
                }
            };

            // Publish portfolio
            const publishPortfolio = async () => {
                try {
                    const docRef = window.firestore.doc(window.db, 'portfolio', currentUserName);
                    const publicUrl = `${window.location.origin}/portfolio/${encodeURIComponent(currentUserName)}`;
                    await window.firestore.setDoc(docRef, { published: true, publicUrl }, { merge: true });
                    publishUrl.textContent = publicUrl;
                    publishModal.classList.remove('hidden');
                    checkPublishedStatus();
                } catch (error) {
                    console.error('Error publishing portfolio:', error);
                    editFormStatus.textContent = 'Error publishing portfolio: ' + error.message;
                    editFormStatus.style.color = 'red';
                }
            };

            // Unpublish portfolio
            const unpublishPortfolio = async () => {
                try {
                    const docRef = window.firestore.doc(window.db, 'portfolio', currentUserName);
                    await window.firestore.setDoc(docRef, { published: false, publicUrl: '' }, { merge: true });
                    checkPublishedStatus();
                    editFormStatus.textContent = 'Portfolio unpublished successfully!';
                    editFormStatus.style.color = 'green';
                } catch (error) {
                    console.error('Error unpublishing portfolio:', error);
                    editFormStatus.textContent = 'Error unpublishing portfolio: ' + error.message;
                    editFormStatus.style.color = 'red';
                }
            };

            // Check published status
            const checkPublishedStatus = async () => {
                try {
                    const docRef = window.firestore.doc(window.db, 'portfolio', currentUserName);
                    const docSnap = await window.firestore.getDoc(docRef);
                    const data = docSnap.exists() ? docSnap.data() : defaultData;
                    if (data.published) {
                        publishButton.classList.add('hidden');
                        unpublishButton.classList.remove('hidden');
                    } else {
                        publishButton.classList.remove('hidden');
                        unpublishButton.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Error checking published status:', error);
                }
            };

            // Load portfolio data from Firestore
            const loadPortfolioData = async () => {
                try {
                    const docRef = window.firestore.doc(window.db, 'portfolio', currentUserName);
                    const docSnap = await window.firestore.getDoc(docRef);
                    const data = docSnap.exists() ? { ...defaultData, ...docSnap.data() } : defaultData;

                    // Update form fields
                    document.getElementById('edit-name').value = data.name || '';
                    document.getElementById('edit-title').value = data.title || '';
                    document.getElementById('edit-about').value = data.about || '';
                    document.getElementById('edit-project1-title').value = data.projects[0]?.title || '';
                    document.getElementById('edit-project1-desc').value = data.projects[0]?.description || '';
                    document.getElementById('edit-project2-title').value = data.projects[1]?.title || '';
                    document.getElementById('edit-project2-desc').value = data.projects[1]?.description || '';
                    document.getElementById('edit-project3-title').value = data.projects[2]?.title || '';
                    document.getElementById('edit-project3-desc').value = data.projects[2]?.description || '';
                    document.getElementById('edit-skill1').value = data.skills[0] ? `${data.skills[0].name},${data.skills[0].progress}` : '';
                    document.getElementById('edit-skill2').value = data.skills[1] ? `${data.skills[1].name},${data.skills[1].progress}` : '';
                    document.getElementById('edit-skill3').value = data.skills[2] ? `${data.skills[2].name},${data.skills[2].progress}` : '';

                    // Update page content
                    currentUserName = data.name || defaultData.name;
                    updateHeroTitle();
                    document.getElementById('hero-subtitle').textContent = data.title || defaultData.title;
                    document.getElementById('about-text').textContent = data.about || defaultData.about;
                    document.getElementById('profile-image').src = data.profileImage || defaultData.profileImage;

                    // Render projects
                    const projectsContainer = document.getElementById('projects-container');
                    projectsContainer.innerHTML = data.projects.map((project, index) => `
                        <div class="bg-charcoal-black p-6 rounded-xl border border-fiery-orange transition-all duration-300 project-card">
                            <img src="${project.image || defaultData.projects[index]?.image || 'https://placehold.co/400x300/FF4500/FFF5E6?text=Project'}" alt="${project.title || 'Project'}" class="w-full h-48 object-cover rounded-md mb-4">
                            <h3 class="text-2xl font-bold mb-2">${project.title || defaultData.projects[index]?.title || 'Untitled Project'}</h3>
                            <p class="text-sm text-soft-cream/80">${project.description || defaultData.projects[index]?.description || 'No description provided'}</p>
                        </div>
                    `).join('');

                    // Render skills
                    const skillsContainer = document.getElementById('skills-container');
                    skillsContainer.innerHTML = data.skills.map((skill, index) => `
                        <div class="flex items-center space-x-4">
                            <span class="w-24 text-right">${skill.name || defaultData.skills[index]?.name || 'Skill'}</span>
                            <div class="flex-1 h-6 rounded-full bg-soft-cream/10 relative">
                                <div class="skill-bar-inner rounded-full" style="width: ${skill.progress || defaultData.skills[index]?.progress || 0}%;"></div>
                            </div>
                        </div>
                    `).join('');

                    // Update published status
                    checkPublishedStatus();
                } catch (error) {
                    console.error('Error loading data:', error);
                    editFormStatus.textContent = 'Error loading portfolio: ' + error.message;
                    editFormStatus.style.color = 'red';
                }
            };

            // Edit form submission
            editForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                editFormStatus.textContent = 'Saving...';
                try {
                    const profileImageFile = document.getElementById('edit-profile-image').files[0];
                    const project1ImageFile = document.getElementById('edit-project1-image').files[0];
                    const project2ImageFile = document.getElementById('edit-project2-image').files[0];
                    const project3ImageFile = document.getElementById('edit-project3-image').files[0];

                    const profileImageUrl = await uploadToImgBB(profileImageFile);
                    const project1ImageUrl = await uploadToImgBB(project1ImageFile);
                    const project2ImageUrl = await uploadToImgBB(project2ImageFile);
                    const project3ImageUrl = await uploadToImgBB(project3ImageFile);

                    const projects = [];
                    for (let i = 1; i <= 3; i++) {
                        const title = document.getElementById(`edit-project${i}-title`).value.trim();
                        const desc = document.getElementById(`edit-project${i}-desc`).value.trim();
                        const image = i === 1 ? project1ImageUrl : i === 2 ? project2ImageUrl : i === 3 ? project3ImageUrl : null;
                        if (title || desc || image) {
                            projects.push({
                                title: title || undefined,
                                description: desc || undefined,
                                image: image || undefined
                            });
                        }
                    }

                    const skills = [];
                    for (let i = 1; i <= 3; i++) {
                        const skillInput = document.getElementById(`edit-skill${i}`).value.trim();
                        if (skillInput) {
                            const [name, progress] = skillInput.split(',').map(s => s.trim());
                            if (name && !isNaN(progress)) {
                                skills.push({ name, progress: parseInt(progress) });
                            }
                        }
                    }

                    const data = {
                        name: document.getElementById('edit-name').value.trim() || currentUserName,
                        title: document.getElementById('edit-title').value.trim() || undefined,
                        about: document.getElementById('edit-about').value.trim() || undefined,
                        profileImage: profileImageUrl || undefined,
                        projects,
                        skills
                    };

                    await savePortfolioData(data);
                } catch (error) {
                    console.error('Error uploading images or saving data:', error);
                    editFormStatus.textContent = 'Error uploading images or saving data: ' + error.message;
                    editFormStatus.style.color = 'red';
                }
            });

            // Contact form submission
            const contactForm = document.getElementById('contact-form');
            const confirmationModal = document.getElementById('confirmation-modal');
            const closeModalBtn = document.getElementById('close-modal');

            const handleFormSubmit = async (e) => {
                e.preventDefault();
                const formStatus = document.getElementById('form-status');
                formStatus.textContent = 'Sending message...';
                try {
                    const name = document.getElementById('name').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const message = document.getElementById('message').value.trim();
                    if (!name || !email || !message) {
                        formStatus.textContent = 'Please fill out all fields.';
                        formStatus.style.color = 'red';
                        return;
                    }
                    await window.firestore.addDoc(window.firestore.collection(window.db, `artifacts/${window.appId}/public/data/contact-messages`), {
                        name,
                        email,
                        message,
                        timestamp: new Date()
                    });
                    formStatus.innerHTML = 'Message sent <span class="text-fiery-orange">✅</span>!';
                    confirmationModal.classList.remove('hidden');
                    contactForm.reset();
                    setTimeout(() => formStatus.textContent = '', 5000);
                } catch (error) {
                    console.error('Error adding document: ', error);
                    formStatus.textContent = 'Failed to send message: ' + error.message;
                    formStatus.style.color = 'red';
                    confirmationModal.querySelector('p:nth-child(2)').textContent = 'Oops! Something went wrong. Please try again.';
                    confirmationModal.classList.remove('hidden');
                }
            };

            // Publish/Unpublish event listeners
            publishButton.addEventListener('click', publishPortfolio);
            unpublishButton.addEventListener('click', unpublishPortfolio);
            closePublishModal.addEventListener('click', () => {
                publishModal.classList.add('hidden');
            });

            copyUrlButton.addEventListener('click', () => {
                const url = publishUrl.textContent;
                navigator.clipboard.writeText(url).then(() => {
                    editFormStatus.textContent = 'URL copied to clipboard!';
                    editFormStatus.style.color = 'green';
                    setTimeout(() => editFormStatus.textContent = '', 3000);
                }).catch(err => {
                    console.error('Error copying URL:', err);
                    editFormStatus.textContent = 'Failed to copy URL.';
                    editFormStatus.style.color = 'red';
                });
            });

            const checkAuthInterval = setInterval(() => {
                if (window.db && window.auth.currentUser) {
                    clearInterval(checkAuthInterval);
                    contactForm.addEventListener('submit', handleFormSubmit);
                    loadPortfolioData();
                }
            }, 100);

            closeModalBtn.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
